#!/usr/bin/env bash
set -euo pipefail

missing=0

print_status() {
    if [[ $1 -eq 0 ]]; then
        printf "[OK] %s\n" "$2"
    else
        printf "[MISSING] %s\n" "$2"
    fi
}

check_tool() {
    local tool=$1
    if command -v "$tool" >/dev/null 2>&1; then
        print_status 0 "$tool found at $(command -v "$tool")"
    else
        print_status 1 "$tool not found"
        missing=1
    fi
}

printf "Checking build prerequisites...\n"

check_tool gcc
check_tool make
check_tool python3

if [[ $missing -ne 0 ]]; then
    printf "\nInstall the missing tools and rerun ./configure.\n"
    exit 1
fi

printf "\nAll required build tools are available. You can now run 'make'.\n"
